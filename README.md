# report-template
Генератор отчётов принимает на вход файл с разметкой и, используя данные о кассах и продажах в базе данных, формирует отчёт в формате csv.
В качестве СУБД используется [SQLite](https://www.sqlite.org/index.html).
Путь к сформированному отчёту задаётся в [конфигурационном файле](#configuration), по умолчанию `src/main/resources/out/reports/<dd-MM-yyyy_HH-mm-ss>/report` 

## Установка
Необходимо клонировать репозиторий проекта:
```
git clone git@github.com:mikhaildruzhinin/report-template.git
```
Чтобы развернуть базу данных, запустите Python скрипт:
```
python3 scripts/setup_db.py
```

## <a name="configuration"></a>Конфигурирование
Конфигурационный файл расположен по адресу `src/main/resources/application.conf`.
Файл содержит следующие параметры:
* `spark.appname` - название приложения
* `spark.master` - URL для подключения к кластеру или `local` для запуска на локальном компьютере
* `database.url` - URL для подключения к базе данных
* `report.datetime_format` - формат вывода даты и времени (для пути к отчётам в файловой системе)
* `report.output_path` - путь к папкам с отчётами в файловой системе

## Запуск

Для сборки проекта использется инструмент [sbt](https://www.scala-sbt.org/index.html).
Чтобы запустить генератор отчётов, выполните в командной строке команду:
```sbt
sbt "run <args>"
```
Вместо `<args>` необходимо подставить приведённые ниже параметры:

#### Список обязательных параметров
* `-p`, `--pathToProductsFile`  `<arg>` путь к файлу с разметкой
* `-f`, `--dateFrom`  `<arg>` дата начала отчёта
* `-t`, `--dateTo`  `<arg>` дата окончания отчёта
#### Список дополнительных параметров 
* `-c`, `--categories`  `<arg>` добавить в отчёт фильтр по списку категорий (категории должны быть указаны через запятую без пробелов)
* `-d`, `--receiptDate` добавить в отчёт разрез по датам
* `-r`, `--region` добавить в отчёт разрез по регионам
* `-l`, `--channel` добавить в отчёт разрез по виду организации (сетевая или не сетевая)
* `-h`, `--help` вывод справки и выход

## Примеры отчётов
В папке [`src/main/resources/examples`](https://github.com/mikhaildruzhinin/report-template/tree/master/src/main/resources/examples) расположены три примера готовых отчётов, составленных в соотвтетствии с таблицей:

| dateFrom   | dateTo     | categories | receiptDate | region | channel  |
|------------|------------|---|-------------|---|---|
| 2019-08-01 | 2019-08-31 |  | false       | false | false  |
| 2019-08-01 | 2019-08-31 |  | true        | true | true  |
| 2019-08-05 | 2019-08-11 | FMCG | false       | true | false  |
